<% layout('/layouts/default') %>

<h1><%- post.title %></h1>
<div style="background:#EEE;padding:5px;">
	<pre class="code"><%- post.body %></pre>
<div align="right">
<% if(post.user) { %>
Programmer: <%- post.user.username %>
<% } %>
<br />
<%- post.createdAt.toLocaleDateString() %>
</div>
</div>

<div style="clear:both;margin-top:20px;"></div>

<h4 id='ref_count'> Refactors</h4>
<hr style='margin-top:0px;'/>
<div class="answers">
<% _.each(post.comments, function(c){ %>
	<div class="answer">
		<pre class='code'><%- c.body %></pre>
		<div align="right">
			Refactored by <%= c.user.username %>
			<br/>
			<%- c.createdAt.toLocaleDateString() %>
		</div>
	</div>
	<hr />
<% }) %>
</div>

<h4>Your Refactor</h4>
<form id='answer' action="/post/<%- post._id %>" method="post">
<textarea id='answer_txtarea'class="writable form-control" name="body" rows="12" required></textarea>
<br />
<button class="btn btn-lg btn-primary" type="submit">Submit</button>
</form>

<script type="text/javascript">
	$(function(){
		$('.code').each(function(){
			var $this = $(this);
			var code = $this.html();
			var options = {
				value: code,
				mode: 'javascript',
				lineNumbers: true,
				readOnly: !$this.is('.writable')
			}
			CodeMirror(function(elt){
				$this.replaceWith(elt);
				}, options)
		});

		$('#ref_count').prepend($('.answer').length);
		var $this = $('#answer_txtarea').get(0);
		var options = {
			theme: 'solarized',
			mode: 'javascript',
			lineNumbers: true
		}
		var cm = CodeMirror.fromTextArea($this, options);
		
		$('#answer').submit(function(e){
			cm.save();
		});
	})	
</script>


